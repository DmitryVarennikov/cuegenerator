function CUEgenerator_Formatter(){}CUEgenerator_Formatter.prototype.getPerfomer=function(string){return'PERFORMER "'+string+'"\n'};CUEgenerator_Formatter.prototype.getTitle=function(string){return'TITLE "'+string+'"\n'};CUEgenerator_Formatter.prototype.getFilename=function(string){return'FILE "'+string+'" MP3\n'};CUEgenerator_Formatter.prototype.getTracklist=function(tracklist,regions_list){var output="";for(i=1;i<tracklist.length;i++){var row=tracklist[i];output+="  TRACK "+row.track+" AUDIO\n";output+='    PERFORMER "'+row.perfomer+'"\n';output+='    TITLE "'+row.title+'"\n';output+="    INDEX 01 "+(regions_list[i]?regions_list[i]:row.time)+"\n"}return output};function CUEgenerator_Parser(){this._parsedTracklist=null}CUEgenerator_Parser.prototype.getPerfomer=function(string){return $.trim(string)};CUEgenerator_Parser.prototype.getTitle=function(string){return $.trim(string)};CUEgenerator_Parser.prototype.getFilename=function(string){return $.trim(string)};CUEgenerator_Parser.prototype.getTracklist=function(string){var splitTitlePerfomer=function(string){var separators=[" - "," – "," ‒ "," — "," ― "];if(-1!==string.search(separators[0])){var splitted=string.split(separators[0])}else if(-1!==string.search(separators[1])){var splitted=string.split(separators[1])}else if(-1!==string.search(separators[2])){var splitted=string.split(separators[2])}else if(-1!==string.search(separators[3])){var splitted=string.split(separators[3])}else if(-1!==string.search(separators[4])){var splitted=string.split(separators[4])}else{var splitted=[string]}return $.map(splitted,function(string){return $.trim(string)})};var tracklist=[];var contents=string.split("\n");for(i=0,track=1;i<contents.length;i++,track++){var row=$.trim(contents[i]);if(!row.length){track--;continue}var time="00:00:00";var title_perfomer=splitTitlePerfomer(row);var perfomer=title_perfomer.shift();var matches=perfomer.match(/^(\d{2}\.)?\[?(\d{2,3}:\d{2})\]?.*$/i);if(null!=matches&&matches.length>1){time=matches[2];time+=":00"}pattern=/^(\d{2}\.)?\[?(\d{2,3}:\d{2})?\]?\s?\d{0,2}(\s|\. )?(.*)$/i;perfomer=perfomer.replace(pattern,"$4");var title=title_perfomer.length>0?title_perfomer.join(" - "):"";perfomer=perfomer.replace(/"/g,"");title=title.replace(/"/g,"");tracklist[track]={track:track<10?"0"+track:track,perfomer:perfomer,title:title,time:time}}return tracklist};CUEgenerator_Parser.prototype.getRegionsList=function(string){var regions_list=new Array;var contents=string.split("\n");line=1;for(i=0;i<contents.length;i++){var row=$.trim(contents[i]);var matches=row.match(/(\d{2}:\d{2}:\d{2}[\.,:]\d{2})/i);if(null!=matches){var time=matches[0].split(":");var hr=time.shift();var mn=time.shift();if(time.length>1){var sc=time.shift();var fr=time.shift()}else{var sc_fr=time.shift();switch(true){case-1!=sc_fr.indexOf("."):sc_fr=sc_fr.split(".");var sc=sc_fr.shift();var fr=sc_fr.shift();break;case-1!=sc_fr.indexOf(","):sc_fr=sc_fr.split(",");var sc=sc_fr.shift();var fr=sc_fr.shift();break}}mn=parseInt(mn,10)+parseInt(hr,10)*60;regions_list[line]=(mn<10?"0"+mn:mn)+":"+sc+":"+fr;line++;continue}var matches=row.match(/(\d{1,5}).(\d{6})/i);if(null!=matches){var milliseconds=matches[2];var seconds=matches[1];var minutes=Math.floor(seconds/60);var mn=minutes>0?minutes:0;var sc=seconds%60;var fr=Math.floor(parseFloat(0+"."+milliseconds)*75);regions_list[line]=(mn<10?"0"+mn:mn)+":"+(sc<10?"0"+sc:sc)+":"+(fr<10?"0"+fr:fr);line++;continue}var matches=row.match(/(\d{2}:\d{2}:\d{2})/i);if(null!=matches){var time=matches[0].split(":");var mn=parseInt(time[0],10);var sc=parseInt(time[1],10);var fr=parseInt(time[2],10);regions_list[line]=(mn<10?"0"+mn:mn)+":"+(sc<10?"0"+sc:sc)+":"+(fr<10?"0"+fr:fr);line++;continue}}return regions_list};function CUEgenerator(){this.parser=new CUEgenerator_Parser;this.formatter=new CUEgenerator_Formatter}CUEgenerator.prototype.toString=function(perfomer_id,title_id,filename_id,tracklist_id,regions_list_id){var output="";output+=this.formatter.getPerfomer(this.parser.getPerfomer($("#"+perfomer_id).val()));output+=this.formatter.getTitle(this.parser.getTitle($("#"+title_id).val()));output+=this.formatter.getFilename(this.parser.getFilename($("#"+filename_id).val()));output+=this.formatter.getTracklist(this.parser.getTracklist($("#"+tracklist_id).val()),this.parser.getRegionsList($("#"+regions_list_id).val()));return output};